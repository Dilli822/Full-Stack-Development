{"ast":null,"code":"// import { useState, useEffect } from \"react\";\n// import { IconButton } from \"@mui/material\";\n// import FavoriteIcon from '@mui/icons-material/Favorite';\n// import ShareIcon from '@mui/icons-material/Share';\n\n// export default function Likes() {\n//   const [blogs, setBlogs] = useState([]);\n//   const [error, setError] = useState(null);\n//   const [countLikes, setCountLikes] = useState(0);\n//   const [likedBy, setLikedBy] = useState(0);\n//   const [authorId, setAuthorId] = useState(null);\n\n//   console.log(authorId);\n//   console.log(likedBy);\n\n//   useEffect(() => {\n//     const fetchBlogs = async () => {\n//       try {\n//         const response = await fetch(\"http://localhost:8000/api/blog/list/\", {\n//           headers: {\n//             Authorization: `Bearer ${localStorage.getItem(\"accessToken\")}`,\n//           },\n//         });\n\n//         const data = await response.json();\n\n//         // Initialize liked state for each blog post\n//         const blogsWithLiked = data.map((blog) => ({ ...blog, liked: false }));\n\n//         setBlogs(blogsWithLiked);\n\n//         setCountLikes(blogsWithLiked[0].likes);\n//         setLikedBy(blogsWithLiked.liked_by);\n\n//         setAuthorId(blogsWithLiked.author);\n//       } catch (error) {\n//         console.error(error);\n//         setError(\"Failed to fetch blog posts.\");\n//       }\n//     };\n\n//     fetchBlogs();\n//   }, []);\n\n//   const handleLikeClick = (blogId) => {\n//     const index = blogs.findIndex((blog) => blog.id === blogId);\n//     const blogToUpdate = { ...blogs[index] };\n\n//     if (blogToUpdate.liked || blogToUpdate.author == authorId) {\n//       // If the blog post is already liked or the author is not the current user,\n//       // don't decrease the like count\n//       if (blogToUpdate.likes > countLikes) {\n//         blogToUpdate.likes--;\n//         setCountLikes(countLikes - 1);\n//       }\n//     } else {\n//       // If the blog post is not liked and the author is the current user, increase the like count by 1\n//       blogToUpdate.likes++;\n//       setCountLikes(countLikes + 1);\n//     }\n\n//     // \n//     // Toggle the liked state for the blog post\n//     blogToUpdate.liked = !blogToUpdate.liked;\n\n//     // Update the state with the new liked state and like count\n//     const newBlogs = [...blogs];\n//     newBlogs[index] = blogToUpdate;\n//     setBlogs(newBlogs);\n\n//     // Update the API with the new liked state and like count\n//     fetch(`http://localhost:8000/api/blog/likes/update/${blogId}/`, {\n//       method: \"PUT\",\n//       headers: {\n//         Authorization: `Bearer ${localStorage.getItem(\"accessToken\")}`,\n//         \"Content-Type\": \"application/json\",\n//       },\n//       body: JSON.stringify({\n\n//           liked: blogToUpdate.liked,\n//           likes: blogToUpdate.likes,\n\n//       }),\n//     })\n//       .then((response) => {\n//         if (!response.ok) {\n//           throw new Error('Failed to update like state.');\n//         }\n//         return response.json();\n//       })\n//       .then((data) => console.log(data))\n//       .catch((error) => {\n//         console.error(error);\n//         setError(\"Failed to update like state.\");\n//       });\n//   };\n\n//   return (\n//     <div>\n\n//       {blogs.map((blog) => (\n//         <div key={blog.id}>\n//           <h2>{blog.title}</h2>\n//           <p>{blog.content}</p>\n//           liked by : {blog.liked_by} <br></br>\n//           likes: <span>{blog.likes}</span>\n\n//           {/* {blog.liked_by == blog.author ? \n//             <div>\n//                         <IconButton onClick={() => handleLikeClick(blog.id)}>\n\n//                         <FavoriteIcon color=\"error\" />\n// </IconButton>\n\n//                </div>\n//             : <div>          <IconButton onClick={() => handleLikeClick(blog.id)}>\n\n//             <FavoriteIcon color=\"error\" />\n// </IconButton>\n// </div>} */}\n\n//  { blog.liked_by !== blog.author_id ? \n//  <div>  liked by author itself   <IconButton onClick={() => handleLikeClick(blog.id)}>\n\n//  <FavoriteIcon color=\"error\" />\n// </IconButton>\n//  </div> : \n//  <div> author didnot like   <IconButton onClick={() => handleLikeClick(blog.id)}>\n\n//  <FavoriteIcon color=\"primary\" />\n// </IconButton>\n// </div> }\n\n//           <IconButton>\n//             <ShareIcon />\n//           </IconButton>\n//         </div>\n//       ))}\n\n//     </div>\n//   );\n// }\n\nconst handleLikeClick = blogId => {\n  const blogToUpdate = blogs.find(blog => blog.id === blogId);\n  const updatedBlog = {\n    ...blogToUpdate,\n    likes: blogToUpdate.likes + (blogToUpdate.liked_by.includes(userId) ? -1 : 1),\n    liked_by: blogToUpdate.liked_by.includes(userId) ? blogToUpdate.liked_by.filter(id => id !== userId) : [...blogToUpdate.liked_by, userId]\n  };\n  fetch(`http://localhost:8000/api/blog/likes/update/${blogId}/`, {\n    method: \"PUT\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(updatedBlog)\n  }).then(response => response.json()).then(data => {\n    const updatedBlogs = blogs.map(blog => blog.id === data.id ? data : blog);\n    setBlogs(updatedBlogs);\n  }).catch(error => console.error(error));\n};","map":{"version":3,"names":["handleLikeClick","blogId","blogToUpdate","blogs","find","blog","id","updatedBlog","likes","liked_by","includes","userId","filter","fetch","method","headers","body","JSON","stringify","then","response","json","data","updatedBlogs","map","setBlogs","catch","error","console"],"sources":["/Users/dillirai/Downloads/Full-Stack-Development/Practice Full Stack dev /Practice/drf-blog-api-master/django/frontend/src/components/likes/blog_Likes.js"],"sourcesContent":["// import { useState, useEffect } from \"react\";\n// import { IconButton } from \"@mui/material\";\n// import FavoriteIcon from '@mui/icons-material/Favorite';\n// import ShareIcon from '@mui/icons-material/Share';\n\n\n// export default function Likes() {\n//   const [blogs, setBlogs] = useState([]);\n//   const [error, setError] = useState(null);\n//   const [countLikes, setCountLikes] = useState(0);\n//   const [likedBy, setLikedBy] = useState(0);\n//   const [authorId, setAuthorId] = useState(null);\n\n//   console.log(authorId);\n//   console.log(likedBy);\n\n\n//   useEffect(() => {\n//     const fetchBlogs = async () => {\n//       try {\n//         const response = await fetch(\"http://localhost:8000/api/blog/list/\", {\n//           headers: {\n//             Authorization: `Bearer ${localStorage.getItem(\"accessToken\")}`,\n//           },\n//         });\n\n//         const data = await response.json();\n\n//         // Initialize liked state for each blog post\n//         const blogsWithLiked = data.map((blog) => ({ ...blog, liked: false }));\n\n//         setBlogs(blogsWithLiked);\n        \n//         setCountLikes(blogsWithLiked[0].likes);\n//         setLikedBy(blogsWithLiked.liked_by);\n        \n//         setAuthorId(blogsWithLiked.author);\n//       } catch (error) {\n//         console.error(error);\n//         setError(\"Failed to fetch blog posts.\");\n//       }\n//     };\n\n//     fetchBlogs();\n//   }, []);\n  \n//   const handleLikeClick = (blogId) => {\n//     const index = blogs.findIndex((blog) => blog.id === blogId);\n//     const blogToUpdate = { ...blogs[index] };\n  \n//     if (blogToUpdate.liked || blogToUpdate.author == authorId) {\n//       // If the blog post is already liked or the author is not the current user,\n//       // don't decrease the like count\n//       if (blogToUpdate.likes > countLikes) {\n//         blogToUpdate.likes--;\n//         setCountLikes(countLikes - 1);\n//       }\n//     } else {\n//       // If the blog post is not liked and the author is the current user, increase the like count by 1\n//       blogToUpdate.likes++;\n//       setCountLikes(countLikes + 1);\n//     }\n  \n//     // \n//     // Toggle the liked state for the blog post\n//     blogToUpdate.liked = !blogToUpdate.liked;\n  \n//     // Update the state with the new liked state and like count\n//     const newBlogs = [...blogs];\n//     newBlogs[index] = blogToUpdate;\n//     setBlogs(newBlogs);\n  \n//     // Update the API with the new liked state and like count\n//     fetch(`http://localhost:8000/api/blog/likes/update/${blogId}/`, {\n//       method: \"PUT\",\n//       headers: {\n//         Authorization: `Bearer ${localStorage.getItem(\"accessToken\")}`,\n//         \"Content-Type\": \"application/json\",\n//       },\n//       body: JSON.stringify({\n    \n//           liked: blogToUpdate.liked,\n//           likes: blogToUpdate.likes,\n    \n\n//       }),\n//     })\n//       .then((response) => {\n//         if (!response.ok) {\n//           throw new Error('Failed to update like state.');\n//         }\n//         return response.json();\n//       })\n//       .then((data) => console.log(data))\n//       .catch((error) => {\n//         console.error(error);\n//         setError(\"Failed to update like state.\");\n//       });\n//   };\n  \n//   return (\n//     <div>\n    \n//       {blogs.map((blog) => (\n//         <div key={blog.id}>\n//           <h2>{blog.title}</h2>\n//           <p>{blog.content}</p>\n//           liked by : {blog.liked_by} <br></br>\n//           likes: <span>{blog.likes}</span>\n          \n//           {/* {blog.liked_by == blog.author ? \n//             <div>\n//                         <IconButton onClick={() => handleLikeClick(blog.id)}>\n\n//                         <FavoriteIcon color=\"error\" />\n// </IconButton>\n\n//                </div>\n//             : <div>          <IconButton onClick={() => handleLikeClick(blog.id)}>\n\n//             <FavoriteIcon color=\"error\" />\n// </IconButton>\n// </div>} */}\n\n//  { blog.liked_by !== blog.author_id ? \n//  <div>  liked by author itself   <IconButton onClick={() => handleLikeClick(blog.id)}>\n\n//  <FavoriteIcon color=\"error\" />\n// </IconButton>\n//  </div> : \n//  <div> author didnot like   <IconButton onClick={() => handleLikeClick(blog.id)}>\n\n//  <FavoriteIcon color=\"primary\" />\n// </IconButton>\n// </div> }\n\n//           <IconButton>\n//             <ShareIcon />\n//           </IconButton>\n//         </div>\n//       ))}\n\n//     </div>\n//   );\n// }\n\n\nconst handleLikeClick = (blogId) => {\n  const blogToUpdate = blogs.find((blog) => blog.id === blogId);\n  const updatedBlog = {\n    ...blogToUpdate,\n    likes: blogToUpdate.likes + (blogToUpdate.liked_by.includes(userId) ? -1 : 1),\n    liked_by: blogToUpdate.liked_by.includes(userId)\n      ? blogToUpdate.liked_by.filter((id) => id !== userId)\n      : [...blogToUpdate.liked_by, userId],\n  };\n  fetch(`http://localhost:8000/api/blog/likes/update/${blogId}/`, {\n    method: \"PUT\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify(updatedBlog),\n  })\n    .then((response) => response.json())\n    .then((data) => {\n      const updatedBlogs = blogs.map((blog) =>\n        blog.id === data.id ? data : blog\n      );\n      setBlogs(updatedBlogs);\n    })\n    .catch((error) => console.error(error));\n};\n"],"mappings":"AAAA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAGA,MAAMA,eAAe,GAAIC,MAAM,IAAK;EAClC,MAAMC,YAAY,GAAGC,KAAK,CAACC,IAAI,CAAEC,IAAI,IAAKA,IAAI,CAACC,EAAE,KAAKL,MAAM,CAAC;EAC7D,MAAMM,WAAW,GAAG;IAClB,GAAGL,YAAY;IACfM,KAAK,EAAEN,YAAY,CAACM,KAAK,IAAIN,YAAY,CAACO,QAAQ,CAACC,QAAQ,CAACC,MAAM,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;IAC7EF,QAAQ,EAAEP,YAAY,CAACO,QAAQ,CAACC,QAAQ,CAACC,MAAM,CAAC,GAC5CT,YAAY,CAACO,QAAQ,CAACG,MAAM,CAAEN,EAAE,IAAKA,EAAE,KAAKK,MAAM,CAAC,GACnD,CAAC,GAAGT,YAAY,CAACO,QAAQ,EAAEE,MAAM;EACvC,CAAC;EACDE,KAAK,CAAE,+CAA8CZ,MAAO,GAAE,EAAE;IAC9Da,MAAM,EAAE,KAAK;IACbC,OAAO,EAAE;MACP,cAAc,EAAE;IAClB,CAAC;IACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAACX,WAAW;EAClC,CAAC,CAAC,CACCY,IAAI,CAAEC,QAAQ,IAAKA,QAAQ,CAACC,IAAI,EAAE,CAAC,CACnCF,IAAI,CAAEG,IAAI,IAAK;IACd,MAAMC,YAAY,GAAGpB,KAAK,CAACqB,GAAG,CAAEnB,IAAI,IAClCA,IAAI,CAACC,EAAE,KAAKgB,IAAI,CAAChB,EAAE,GAAGgB,IAAI,GAAGjB,IAAI,CAClC;IACDoB,QAAQ,CAACF,YAAY,CAAC;EACxB,CAAC,CAAC,CACDG,KAAK,CAAEC,KAAK,IAAKC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC,CAAC;AAC3C,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}